# Webシステム開発AIエージェントチーム 開発TODO

## フェーズ1: 基盤構築とコアエージェント設定

### 環境構築
- [x] Python、CrewAI、Gitなどの基本環境セットアップ
- [x] バージョン管理リポジトリの設定
- [x] 開発用ドキュメント整備（README.md作成など）
- [x] 環境変数設定テンプレート（.env.example）の作成

### コアエージェント実装
- [x] PdM（プロダクトマネージャー）エージェント定義
- [x] PM（プロジェクトマネージャー）エージェント定義
- [x] PL（プロジェクトリード）エージェント定義
- [x] デザイナーエージェント定義
- [x] エンジニアエージェント定義
- [x] テスターエージェント定義

### 基本タスク連携
- [x] CrewAIでのタスク定義実装
- [x] エージェント間の基本的な連携フロー実装
- [x] PM → PL → エンジニアのタスク受け渡しプロセス実装

### 基本ツール統合
- [x] ファイル読み書きツール実装
- [x] 簡単なWeb検索ツール実装
- [x] エージェントがツールを利用できる連携実装
- [x] コード実行サンドボックス基本実装（tools/code_sandbox.py）

### 基本ログ機能
- [x] エージェントの基本動作ログ出力機能実装
- [x] ログ保存・表示の仕組み構築

## フェーズ2: Web開発ワークフローの実装

### PdMエージェント機能強化
- [x] ユーザー要求の解釈・分析ロジック実装
- [x] バックログ項目生成機能実装
- [x] 要求優先順位付け機能実装

### PMエージェント機能強化
- [x] バックログベースのタスク分解ロジック実装
- [x] エージェントへのタスク割当機能実装
- [x] スケジュール管理・進捗監視機能実装

### デザイナーエージェント機能強化
- [x] UI/UX仕様生成ロジック実装
- [x] モックアップ/ワイヤーフレーム作成機能実装
- [x] デザイン仕様のPL連携機能実装

### PLエージェント機能強化
- [x] 技術仕様生成ロジック実装
- [x] エンジニアへの実装指示作成機能実装
- [x] コードレビュー機能の基礎実装

### エンジニアエージェント機能強化
- [x] コード生成ロジック実装（HTML, Python/Flaskなど）
- [x] 基本的なコード実行サンドボックス環境実装
- [x] デバッグ機能の基礎実装

### テスターエージェント機能強化
- [x] テストケース生成ロジック実装
- [x] テスト実行（シミュレーション）機能実装
- [x] バグ報告機能実装

### コアワークフロー実装
- [x] 要求→設計→仕様→実装→テストの一連フローをCrewAIプロセスとして定義
- [x] 各ステップ間の連携とデータ受け渡し実装
- [x] プロセス全体の実行と監視機能実装

## フェーズ3: 機能強化・統合・最適化

### 動的エージェントスケーリング
- [x] 負荷に応じたエージェント数調整メカニズム実装
- [x] エンジニア/テスターの動的インスタンス管理実装
- [x] スケーリング判断ロジック実装

### エージェント間通信プロトコル実装
- [x] A2A（Agent to Agent）プロトコル実装
- [x] ACP（Agent Communication Protocol）実装
- [x] 異なるエージェント間の標準通信インターフェース実装

### マルチモーダル対応
- [x] MML（Multimodal Markup Language）サポート実装
- [x] テキスト、画像、表、グラフなどの複合メディア処理実装
- [x] マルチモーダルコンテンツの生成・変換機能実装

### MCP互換性対応
- [x] Model Context Protocol (MCP) コネクタ実装
- [x] MCPを介した外部ツール・データソース連携機能実装
- [x] 将来的な標準化を見据えた設計最適化

### 高度なツール統合
- [x] 依存関係管理を含むコード実行サンドボックス実装
- [x] データベース操作ツール実装
- [x] 特定Webフレームワーク用ツール実装

### 専門エージェント実装
- [x] AIアーキテクトエージェント実装
- [x] プロンプトエンジニアエージェント実装
- [x] データエンジニアエージェント実装
- [x] 専門エージェントとコアエージェントとの連携プロセス定義

### 専門エージェント連携実装
- [x] 連携ワークフロー自動化機能の実装
- [x] 専門エージェント起動判断ロジックの実装
- [x] 標準通信プロトコルライブラリの実装
- [x] タスク依頼・結果共有のAPIエンドポイント実装
- [x] ベクトルDBを活用した知識共有機能の実装
- [x] 専門エージェント活用状況モニタリングダッシュボード実装

### ユニットテスト実装
- [x] テスト環境セットアップ
  - [x] pyestなどのテストフレームワーク導入
  - [x] テスト用のディレクトリ構造作成
  - [x] テスト用のfixture/helperモジュール作成
  - [x] CI/CD用のテスト自動実行設定

- [x] utils/agent_communication.py のテスト
  - [x] AgentMessageクラスの基本機能テスト
  - [x] TaskRequest/TaskResponseクラスのテスト
  - [x] MessageDispatcherの登録・送信機能テスト
  - [x] メッセージの処理・キュー管理テスト
  - [x] ヘルパー関数（create_task_request, send_task_requestなど）のテスト
  - [x] エラー処理とエッジケーステスト

- [x] utils/workflow_automation.py のテスト
  - [x] SpecialistTaskRegistryのタスク登録・取得テスト
  - [x] タスク状態更新・結果設定のテスト
  - [x] 承認・拒否プロセスのテスト
  - [x] タスク履歴・統計情報取得のテスト
  - [x] ファイルへの保存・読み込みテスト
  - [x] SpecialistWorkflowAutomationの基本機能テスト
  - [x] タスク依頼・専門エージェント判断のテスト
  - [x] 各種ハンドラーのテスト
  - [x] ヘルパー関数のテスト

- [x] utils/specialist_triggers.py のテスト
  - [x] SpecialistTriggerAnalyzerの分析機能テスト
  - [x] 専門エージェント判定パターンのテスト
  - [x] 信頼度計算のテスト
  - [x] コンテキスト情報による調整機能のテスト
  - [x] タスク種別推定機能のテスト
  - [x] ヘルパー関数のテスト
  - [x] 複合条件・エッジケーステスト

- [x] api/specialist_api.py のテスト
  - [x] FastAPIエンドポイントのテスト
  - [x] リクエスト/レスポンスモデルの検証
  - [x] タスク依頼エンドポイントのテスト
  - [x] 要求分析エンドポイントのテスト
  - [x] タスク取得・更新エンドポイントのテスト
  - [x] 承認・拒否エンドポイントのテスト
  - [x] ダッシュボードデータエンドポイントのテスト
  - [x] エラーハンドリングのテスト

- [x] api/dashboard.py のテスト
  - [x] Dashアプリケーション初期化テスト
  - [x] データ取得関数のテスト
  - [x] コールバック関数のテスト
  - [x] グラフ生成機能のテスト
  - [x] UIコンポーネント描画テスト
  - [x] エラー処理のテスト

- [x] api/run_api.py のテスト
  - [x] サーバー起動関数のテスト
  - [x] 引数解析・処理のテスト
  - [x] スレッド・サブプロセス起動のテスト
  - [x] シグナルハンドリングのテスト

- [x] 統合・システムテスト
  - [x] 専門エージェント連携フローのエンドツーエンドテスト
  - [x] APIとダッシュボードの連携テスト
  - [x] 完全なワークフローのテスト
  - [x] パフォーマンステスト
  - [x] 負荷テスト

### テスト修正タスク
- [x] utils/agent_communication.py の修正
  - [x] タスク状態取得機能の修正（get_task_status）
  - [x] StatusUpdateからのタスク状態取得機能の修正
  - [x] メッセージキュー管理の改善

- [x] utils/specialist_triggers.py の修正
  - [x] PROMPT_ENGINEER_PATTERNSのパターンマッチング修正（「LLMへの指示を最適化」などが正しくマッチするよう修正）
  - [x] 専門エージェント判定ロジックの改善（analyze_request）
  - [x] 信頼度計算ロジック（_calculate_confidence）の調整
  - [x] スコア閾値の再検討

- [x] utils/workflow_automation.py の修正
  - [x] タスク拒否処理（reject_task）のバグ修正
  - [x] タスク登録/管理の堅牢性向上
  - [x] MessageDispatcherのインポート問題解決
  - [x] SpecialistWorkflowAutomation初期化処理の修正

- [x] APIテスト環境の整備
  - [x] 必要な依存パッケージのインストール（selenium等）
  - [x] Dashテスト用モック作成
  - [x] テスト用ヘッドレスブラウザ設定

- [x] 統合テストの修正
  - [x] 専門エージェント連携フローのエンドツーエンドテスト修正
  - [x] タスク登録と取得のフロー改善
  - [x] ダッシュボードデータ生成の修正

### プロンプト改善と最適化
- [ ] 各エージェントのプロンプト精度向上
- [ ] LLM応答の効率改善
- [ ] エージェント間連携のプロンプト最適化

### エラーハンドリング強化
- [ ] タスク失敗時のリトライ機構実装
- [ ] 代替手段検討ロジック実装
- [ ] エラー報告と回復プロセス実装

### Human-in-the-loop (HITL) インターフェース
- [ ] プロダクトオーナー向け要求入力UI開発
- [ ] 開発者向け監視・介入UI開発
- [ ] PMとプロダクトオーナー間の承認フロー実装

### オブザーバビリティ強化
- [ ] 詳細な分散トレーシング実装
- [ ] メトリクス監視ダッシュボード構築
- [ ] アラートシステム実装

### セキュリティ対策
- [ ] APIキー管理機構実装
- [ ] 入力サニタイズ機能実装
- [ ] アクセス制御実装

### パフォーマンス最適化
- [ ] ボトルネック特定と改善
- [ ] LLM呼び出しの最適化
- [ ] キャッシュ機構の実装

### APIの機能強化
- [x] API認証・認可機能の実装
  - [x] JWT認証の実装
  - [x] ロールベースのアクセス制御
  - [x] API利用制限（レート制限）の実装
  
- [x] APIエラーハンドリングの強化
  - [x] グローバルエラーハンドラの実装
  - [x] エラーレスポンスの標準化
  - [x] クライアント向けエラーメッセージの最適化
  
- [x] HITL（Human-in-the-loop）インターフェースAPI
  - [x] PM承認フローのREST APIエンドポイント実装
  - [x] ユーザーフィードバック収集APIの実装
  - [x] タスク手動割り当てインターフェースの実装
  
- [x] APIドキュメント自動生成
  - [x] OpenAPI（Swagger）ドキュメント生成
  - [x] APIエンドポイント使用例の追加
  - [x] 認証・認可フロードキュメント

- [x] API統合テスト環境の改善
  - [x] workflow_automation属性の問題解決
  - [x] APIパスの一貫性確保
  - [x] モックサーバーの強化

- [x] APIモニタリングの強化
  - [x] リクエスト・レスポンスのロギング強化
  - [x] パフォーマンスメトリクスの収集
  - [x] 異常検知の実装

- [x] APIのパフォーマンス最適化
  - [x] データベースクエリの最適化
  - [x] レスポンスのキャッシュ機構
  - [x] 非同期処理の実装

### API・ダッシュボードのテスト改善
- [x] API統合テスト修正
  - [x] TestWorkflowAutomationAttributeFix.test_attribute_fixのモック問題解決
    - [x] tests/test_api/test_api_integration.pyでのモック設定を実際の実装に合わせて修正
    - [x] mock_requestの使用方法の見直し（実際の実装では内部メソッドを使用している可能性）

- [x] ダッシュボード関連修正
  - [x] タイトル不一致の修正
    - [x] api/dashboard.pyのアプリケーション初期化タイトルを「専門エージェント活用状況モニタリングダッシュボード」に修正
    - [x] またはテストの期待値を実際のタイトルに合わせて修正
  - [x] get_dashboard_data_error関数の修正
    - [x] エラー時の処理を見直し、Noneを返すようにapi/dashboard.pyを修正
  - [x] インターバルコールバック関連の修正
    - [x] callback_mapの構造を確認し、テストの条件を実際の実装に合わせて調整

- [x] API実行関連修正
  - [x] test_run_api_serverテストの修正
    - [x] モックの対象を正しいものに修正（api.run_api.uvicornが存在しない問題）
  - [x] test_run_dashboard_serverテストの修正
    - [x] モックの対象を正しいものに修正（api.run_api.appが存在しない問題）

- [x] コード非推奨警告対応
  - [x] datetime.utcnow()の使用箇所の修正
    - [x] api/auth.py:123の修正：datetime.datetime.now(datetime.UTC)を使用
    - [x] api/auth.py:197の修正：datetime.datetime.now(datetime.UTC)を使用

- [x] テスト環境整備
  - [x] 必要なパッケージのインストール
    - [x] python-jose (JWT認証)
    - [x] passlib (パスワードハッシュ)
    - [x] python-multipart (フォームデータ処理)
    - [x] bcrypt (パスワード暗号化)
  - [x] APIサーバー起動依存テストの改善
    - [x] テスト用モックの修正（TestWorkflowAutomationAttributeFix.test_attribute_fixのモック問題）
  - [x] selenium関連の警告は許容（テスト実行に影響なし）

### テスト改善結果サマリー
- [x] API統合テスト (tests/test_api/test_api_integration.py)
  - 全9テストが正常に通過
  - マイナー警告「crypt is deprecated」があるが、動作には影響なし

- [x] ダッシュボードテスト (tests/test_api/test_dashboard.py)
  - 全5テスト成功、1テストskip
  - タイトル不一致、エラーハンドリング、コールバック問題を修正

- [ ] テスト問題残件（優先度低）
  - run_apiテスト：モックの問題で2テスト失敗
  - 統合テスト：APIサーバー接続エラーでテスト失敗
  - ワークフローテスト：タスクデータ関連の不具合

※テスト全体でAPIモジュールに対する重複テストが多く、完全な統合テストよりもAPIモジュールの単体テストに集中した方が効率的です。

## フェーズ4: パイロットプロジェクトと反復

### パイロット計画
- [ ] 適用対象となる小規模Webプロジェクト選定
- [ ] パイロット実施計画策定
- [ ] 評価基準の設定

### パイロット実施
- [ ] AIエージェントチームによるプロジェクト実行
- [ ] 人間との協働プロセス検証
- [ ] 成果物の品質評価

### 評価とフィードバック
- [ ] パフォーマンス評価
- [ ] 生成物品質評価
- [ ] ボトルネック特定
- [ ] 人間との連携評価

### システム改善
- [ ] エージェントロジックの改善
- [ ] プロンプトの最適化
- [ ] ツールの機能強化
- [ ] 連携プロセスの最適化

## インフラ整備

### 開発環境
- [ ] ローカル開発環境構築手順のドキュメント化
- [ ] CI/CD環境の整備

### クラウド環境
- [ ] GCP環境セットアップ
- [ ] GKEクラスタ構築
- [ ] Vercel環境セットアップ
- [ ] Neon（PostgreSQL）データベース構築

### データストア
- [ ] Stateメモリストア構築
- [ ] アーティファクトストア構築（GCS）
- [ ] ベクトルデータベース構築
- [ ] ログ/トレースストア構築

### ネットワーク設定
- [ ] GCPネットワーク設定（VPC, Cloud NAT）
- [ ] GKEネットワークポリシー設定
- [ ] Vercelとの連携設定 